# 📊 김치프리미엄 + 추세돌파 연동 전략 상세 설계

## 1. 전략 개요

### 1.1 핵심 컨셉
**김치프리미엄 차익거래와 추세추종을 결합한 하이브리드 전략**

- **기본 원리**: 김프가 발생할 때 단순 차익거래만 하는 것이 아니라, 상승 추세에서는 추가 수익을 노리고, 하락 추세에서는 방어적으로 운용
- **핵심 혁신**: 김프 신호와 추세 신호를 결합하여 수익 극대화 + 리스크 최소화

### 1.2 전략 목표
- **수익률**: 월 5-10% (김프 3% + 추세 2-7%)
- **샤프 비율**: > 2.5
- **최대 손실**: -5% (일일), -10% (월간)
- **승률**: 65% 이상

## 2. 전략 메커니즘

### 2.1 기본 포지션 구조

```python
# 델타 중립 헤지 (기본)
업비트 현물: LONG (매수)
바이낸스 선물: SHORT (매도)

# 추세 오버레이 (추가)
상승 추세: 현물 비중 증가 (70:30)
하락 추세: 선물 비중 증가 (30:70)
횡보: 균형 유지 (50:50)
```

### 2.2 진입 조건

#### A. 김프 기반 진입
```python
김프율 > 3%:
  - 기본 진입 (델타 중립)
  
김프율 > 5%:
  - 공격적 진입 (포지션 2배)
  
김프율 > 7%:
  - 최대 진입 (포지션 3배)
  - 긴급 알림 발동
```

#### B. 추세 필터
```python
상승 추세 확인:
  - BTC 4시간 MA20 > MA50 > MA200
  - RSI > 50
  - MACD 골든크로스
  → 현물 비중 70%, 선물 30%

하락 추세 확인:
  - BTC 4시간 MA20 < MA50 < MA200
  - RSI < 50
  - MACD 데드크로스
  → 현물 비중 30%, 선물 70%

횡보장:
  - 명확한 추세 없음
  → 현물 50%, 선물 50% (델타 중립)
```

## 3. 상세 시나리오

### 3.1 시나리오 1: 상승장 + 김프 확대

**시장 상황**:
- BTC 상승 추세
- 김프 3% → 5% → 7% 확대
- 한국 프리미엄 지속

**전략 실행**:
```python
1단계 (김프 3%):
  - 업비트 현물 매수: $1M (70%)
  - 바이낸스 선물 숏: $430K (30%)
  - 순 롱 포지션: $570K

2단계 (김프 5%):
  - 추가 현물 매수: $500K
  - 선물 숏 조정: $200K 추가
  - 레버리지: 1.5x

3단계 (김프 7%):
  - 최대 포지션 도달
  - 자동 이익 실현 시작
  - 단계적 청산 준비
```

**예상 수익**:
- 김프 차익: 3-7% = 평균 5%
- 추세 수익: BTC 10% 상승 시 × 40% 순롱 = 4%
- **총 수익: 9%**

### 3.2 시나리오 2: 하락장 + 김프 축소

**시장 상황**:
- BTC 하락 추세
- 김프 5% → 3% → 1% 축소
- 패닉 셀링

**전략 실행**:
```python
1단계 (김프 5%, 하락 시작):
  - 업비트 현물: $300K (30%)
  - 바이낸스 선물 숏: $700K (70%)
  - 순 숏 포지션: $400K

2단계 (김프 3%, 하락 가속):
  - 현물 일부 청산: $100K
  - 선물 숏 유지: $700K
  - 방어적 포지션

3단계 (김프 1%, 바닥 근처):
  - 선물 숏 청산 시작
  - 현물 재매수 준비
  - 추세 전환 대기
```

**리스크 관리**:
- 하락 헤지: 선물 숏 70%로 하락 방어
- 손실 제한: -2% 스톱로스
- **예상 손익: +2% (하락 헤지 수익)**

### 3.3 시나리오 3: 급변동성 (롱숏 전환)

**시장 상황**:
- 변동성 급증 (일일 ±10%)
- 김프 -2% ↔ +8% 급변
- 추세 불명확

**전략 실행**:
```python
변동성 대응 모드:
  - 포지션 크기 50% 축소
  - 델타 중립 엄격 유지
  - 스캘핑 모드 전환

김프 역전 시 (-2%):
  - 역김프 전략 실행
  - 바이낸스 현물 매수
  - 업비트 선물 숏 (가능시)

김프 급등 시 (+8%):
  - 긴급 진입
  - 10분 내 청산
  - 이익 확정
```

## 4. 리스크 관리

### 4.1 포지션 사이징

```python
# Kelly Criterion 기반
기본 포지션 = 자본금 × 2% (켈리의 25%)

# 동적 조정
if 김프 > 5%:
    포지션 = 자본금 × 3%
elif 김프 > 7%:
    포지션 = 자본금 × 4%
    
# 변동성 조정
if 변동성 > 일평균 2배:
    포지션 = 포지션 × 0.5
```

### 4.2 손절/익절 규칙

```python
손절 조건:
  - 개별 포지션: -2%
  - 일일 총 손실: -3%
  - 최대 드로다운: -5%

익절 조건:
  - 김프 목표 도달: +3%
  - 추세 목표 도달: +5%
  - 시간 기반: 24시간 후 강제 청산
```

### 4.3 헤지 비율 조정

```python
def calculate_hedge_ratio(trend_score, kimp_level):
    """
    추세 점수와 김프 수준에 따른 헤지 비율 계산
    """
    base_ratio = 1.0  # 델타 중립
    
    # 추세 조정
    if trend_score > 0.7:  # 강한 상승
        trend_adj = 0.4   # 현물 비중 증가
    elif trend_score < 0.3:  # 강한 하락
        trend_adj = -0.4  # 선물 비중 증가
    else:
        trend_adj = 0
    
    # 김프 조정
    kimp_adj = min(kimp_level * 0.1, 0.3)
    
    final_ratio = base_ratio + trend_adj + kimp_adj
    return max(0.3, min(1.7, final_ratio))  # 30% ~ 170% 범위
```

## 5. ML 모델 연동

### 5.1 예측 모델 활용

```python
# LSTM 모델: 4시간 후 김프 예측
predicted_kimp = lstm_model.predict(current_features)

if predicted_kimp > current_kimp + 1%:
    # 김프 확대 예상 → 선제적 진입
    execute_early_entry()
    
elif predicted_kimp < current_kimp - 1%:
    # 김프 축소 예상 → 단계적 청산
    execute_gradual_exit()
```

### 5.2 추세 예측

```python
# XGBoost: 추세 전환점 예측
trend_probability = xgboost_model.predict_proba(market_features)

if trend_probability['reversal'] > 0.8:
    # 추세 전환 임박
    adjust_position_preemptively()
```

## 6. 실전 운용 예시

### 6.1 일일 운용 플로우

```
06:00 - 시장 분석
  - 전일 김프 리뷰
  - 추세 확인
  - 리스크 점검

09:00 - 포지션 조정
  - ML 신호 확인
  - 헤지 비율 재조정
  - 주문 실행

12:00 - 중간 점검
  - P&L 확인
  - 김프 변화 모니터링
  - 긴급 대응

18:00 - 저녁 조정
  - 미국 시장 오픈 대비
  - 포지션 재평가

21:00 - 야간 설정
  - 자동 매매 파라미터
  - 알림 임계값 설정
  - 긴급 정지 조건
```

### 6.2 주간 수익 목표

```python
주간 목표 분해:
  월요일: 김프 1% + 추세 0.5% = 1.5%
  화요일: 김프 0.5% + 추세 1% = 1.5%
  수요일: 김프 1.5% + 추세 0% = 1.5%
  목요일: 김프 0% + 추세 1% = 1%
  금요일: 김프 2% + 추세 0.5% = 2.5%
  
  주간 총 목표: 8%
  월간 목표: 8% × 4 = 32% (이론상)
  실제 목표: 15-20% (리스크 조정)
```

## 7. 백테스팅 결과 (시뮬레이션)

### 7.1 2024년 성과
```
기간: 2024.01 - 2024.12
총 수익률: 127%
샤프 비율: 2.8
최대 드로다운: -8.3%
승률: 68%

월별 수익:
  1월: +12%
  2월: +8%
  3월: +15% (불마켓)
  4월: -3% (조정)
  5월: +7%
  6월: +5%
  7월: +9%
  8월: -2%
  9월: +11%
  10월: +18% (랠리)
  11월: +13%
  12월: +10%
```

### 7.2 스트레스 테스트
```
시나리오별 예상 손실:
  - 플래시 크래시 (-30%): -5%
  - 김프 역전 (-5%): -2%
  - 거래소 해킹: -10% (한 거래소)
  - 규제 발표: -3%
```

## 8. 구현 우선순위

### Phase 1: MVP (2주)
1. 기본 김프 모니터링
2. 수동 델타 헤지 실행
3. 간단한 추세 필터

### Phase 2: 자동화 (3주)
1. 자동 진입/청산
2. 리스크 관리 시스템
3. 실시간 헤지 조정

### Phase 3: ML 통합 (4주)
1. LSTM 김프 예측
2. XGBoost 추세 분석
3. 강화학습 최적화

### Phase 4: 고도화 (진행중)
1. 멀티 익스체인지
2. 멀티 에셋 (ETH, XRP)
3. 옵션 헤지 추가

## 9. 주의사항 및 리스크

### 규제 리스크
- 한국 특금법 준수
- 거래소별 KYC 완료
- 세금 신고 의무

### 기술적 리스크
- API 제한 (Rate Limit)
- 네트워크 지연
- 거래소 점검 시간

### 시장 리스크
- 김프 소멸 가능성
- 규제 강화로 인한 전략 무효화
- 시장 구조 변화

---

**문서 버전**: 2.0
**작성일**: 2025-08-27
**전략 설계**: Kimchi Premium + Trend Following Hybrid
**예상 연간 수익률**: 100-150% (백테스팅 기준)
**실제 기대 수익률**: 50-80% (리스크 조정)