# 김치 프리미엄 차익거래 모델 비교 테스트 계획서
*작성일: 2025-08-24*
*버전: 1.0*

## 1. 개요 (Executive Summary)

### 1.1 목적
4개의 서로 다른 ML 모델을 동일한 조건에서 실거래 테스트하여, 가장 수익성 높고 안정적인 모델을 선정하기 위함.

### 1.2 테스트 방법
- **자본금**: 각 모델당 200만원 (총 800만원)
- **기간**: 4주간 실거래
- **평가**: 수익률, 안정성, 리스크 지표 종합 평가

### 1.3 의사결정 프로세스
1. 4주 테스트 후 상위 2개 모델 선정
2. 추가 2주 테스트 (각 1000만원)
3. 최종 모델 선정 후 4000만원 투입

## 2. 테스트 대상 모델

### 2.1 Model A: LSTM with Attention
```python
# 구현 위치: src/ml/lstm_model_fixed.py
특징:
- 시계열 장기 패턴 학습
- Attention 메커니즘으로 중요 시점 포착
- 48시간 히스토리 사용

장점:
- 복잡한 패턴 인식 가능
- 장기 의존성 학습

단점:
- 과적합 위험
- 느린 추론 속도
- 많은 데이터 필요
```

### 2.2 Model B: XGBoost Ensemble
```python
# 구현 위치: src/ml/xgboost_enhanced.py
특징:
- Gradient Boosting 앙상블
- Feature engineering 중심
- 실시간 특징 업데이트

장점:
- 빠른 학습/추론
- 해석 가능성
- 적은 데이터로도 작동

단점:
- 시계열 패턴 약함
- 단기 관점만 고려
```

### 2.3 Model C: Micro Scalping Ensemble
```python
# 구현 위치: src/ml/micro_scalping_model.py
특징:
- 3개 모델 앙상블 (Momentum, Mean Reversion, Volatility)
- 0.03-0.05% 미세 움직임 포착
- 적응형 파라미터 조정

장점:
- 높은 거래 빈도
- 리스크 분산
- 온라인 학습

단점:
- 수수료 민감
- 슬리피지 영향 큼
```

### 2.4 Model D: Hybrid RL Agent (PPO)
```python
# 구현 위치: src/ml/rl_agent.py (구현 예정)
특징:
- Proximal Policy Optimization
- 자동 전략 학습
- 리워드 기반 최적화

장점:
- 시장 변화 적응
- 자동 전략 발견
- End-to-end 최적화

단점:
- 불안정한 학습
- 블랙박스
- 초기 성능 낮음
```

## 3. 테스트 환경 설정

### 3.1 거래 환경
```yaml
거래소:
  업비트: 현물 거래
  바이낸스: 선물 거래

자본 배분:
  모델당: 200만원
  업비트: 100만원 (현물)
  바이낸스: 100만원 (선물 마진)

포지션 제한:
  최대 포지션: 0.01 BTC
  최대 레버리지: 2x
  일일 최대 거래: 50회
```

### 3.2 리스크 관리
```yaml
손실 제한:
  일일 최대 손실: -2%
  주간 최대 손실: -5%
  전체 최대 손실: -10% (자동 중단)

포지션 관리:
  최대 보유 시간: 1시간
  강제 청산: -1% 손실
  
비상 정지:
  API 오류: 3회 연속 실패시
  비정상 스프레드: 김프 ±5% 초과시
  시스템 오류: 자동 전체 청산
```

## 4. 성과 평가 지표

### 4.1 주요 지표 (Primary Metrics)

| 지표 | 가중치 | 목표값 | 측정 방법 |
|------|--------|--------|----------|
| 총 수익률 | 30% | > 10% | (최종자본 - 초기자본) / 초기자본 |
| Sharpe Ratio | 25% | > 1.5 | (수익률 - 무위험수익률) / 변동성 |
| 최대 낙폭 | 20% | < -5% | 최고점 대비 최대 하락률 |
| 승률 | 15% | > 60% | 수익 거래 / 전체 거래 |
| 일관성 | 10% | > 0.7 | 일일 수익 양수 비율 |

### 4.2 보조 지표 (Secondary Metrics)

```python
# 실시간 모니터링 지표
- 평균 거래당 수익
- 평균 보유 시간
- 슬리피지 비용
- API 지연 시간
- 모델 추론 시간
```

## 5. 테스트 일정

### Phase 1: 준비 단계 (1주)
```
Week 1:
  Day 1-2: 모든 모델 구현 완료 및 단위 테스트
  Day 3-4: Paper trading 시스템 구축
  Day 5-6: 각 모델 Paper trading 테스트
  Day 7: 리스크 관리 시스템 점검
```

### Phase 2: Paper Trading (1주)
```
Week 2:
  - 4개 모델 동시 Paper trading
  - 일일 성과 리뷰
  - 버그 수정 및 파라미터 조정
  - 실거래 준비 최종 점검
```

### Phase 3: 실거래 테스트 (4주)
```
Week 3-6:
  매일:
    09:00 - 시스템 점검
    09:30 - 거래 시작
    21:00 - 일일 리포트
    
  매주:
    - 주간 성과 분석
    - 파라미터 미세 조정 (필요시)
    - 리스크 점검
```

### Phase 4: 최종 선정 (1주)
```
Week 7:
  Day 1-2: 전체 데이터 분석
  Day 3-4: 상위 2개 모델 선정
  Day 5: 최종 보고서 작성
  Day 6-7: 확대 테스트 준비
```

## 6. 데이터 수집 및 분석

### 6.1 실시간 데이터 수집
```python
# 수집할 데이터
class TradeData:
    timestamp: datetime
    model_name: str
    action: str  # BUY, SELL, HOLD
    entry_price: float
    exit_price: float
    kimchi_premium_entry: float
    kimchi_premium_exit: float
    position_size: float
    pnl: float
    fees: float
    slippage: float
    holding_time: int
    exit_reason: str
```

### 6.2 일일 리포트
```yaml
포함 내용:
  - 각 모델별 거래 횟수
  - 수익/손실 내역
  - 승률 변화
  - 이상 거래 플래그
  - 시스템 로그
```

## 7. 의사결정 매트릭스

### 7.1 모델 선정 기준

| 조건 | Model A | Model B | Model C | Model D | 결정 |
|------|---------|---------|---------|---------|------|
| 수익률 > 10% | ? | ? | ? | ? | 통과 |
| Sharpe > 1.5 | ? | ? | ? | ? | 통과 |
| 낙폭 < -5% | ? | ? | ? | ? | 통과 |
| 승률 > 60% | ? | ? | ? | ? | 통과 |
| 안정성 점수 > 70 | ? | ? | ? | ? | 통과 |

### 7.2 최종 선정 규칙
```python
if 모든_지표_충족:
    score = (수익률 * 0.3 + 
             sharpe * 0.25 + 
             (1 - 낙폭) * 0.2 + 
             승률 * 0.15 + 
             일관성 * 0.1)
    
    if score > 0.7:
        return "채택"
    elif score > 0.5:
        return "조건부 채택 (파라미터 조정 후)"
    else:
        return "기각"
```

## 8. 리스크 및 대응 방안

### 8.1 식별된 리스크

| 리스크 | 확률 | 영향 | 대응 방안 |
|--------|------|------|----------|
| 모델 과적합 | 높음 | 높음 | 실시간 검증, 조기 중단 |
| API 장애 | 중간 | 높음 | 백업 API, 자동 복구 |
| 슬리피지 과다 | 높음 | 중간 | 지정가 주문, 포지션 축소 |
| 급격한 시장 변화 | 낮음 | 높음 | 서킷브레이커, 자동 청산 |
| 해킹/보안 | 낮음 | 치명적 | API 키 분리, 2FA, IP 화이트리스트 |

### 8.2 비상 대응 프로토콜
```python
class EmergencyProtocol:
    def __init__(self):
        self.max_daily_loss = -0.02  # -2%
        self.max_api_errors = 3
        self.abnormal_spread = 0.05  # 5%
    
    def check_emergency(self, state):
        if state.daily_loss < self.max_daily_loss:
            self.execute_emergency_stop("Daily loss limit")
        
        if state.api_errors >= self.max_api_errors:
            self.execute_emergency_stop("API failures")
        
        if abs(state.kimchi_premium) > self.abnormal_spread:
            self.execute_emergency_stop("Abnormal spread")
    
    def execute_emergency_stop(self, reason):
        # 1. 모든 포지션 즉시 청산
        # 2. 신규 거래 중단
        # 3. 알림 발송
        # 4. 로그 저장
        pass
```

## 9. 예산 및 비용

### 9.1 초기 투자
```
거래 자본: 800만원 (각 200만원 × 4)
인프라 비용:
  - AWS/GCP: 월 10만원
  - API 비용: 월 5만원
  - 모니터링: 월 3만원
  
예상 거래 비용:
  - 수수료: 일 2만원 (0.15% × 거래량)
  - 슬리피지: 일 1만원
  
총 월간 비용: 약 100만원
```

### 9.2 손익분기점
```
필요 수익률: 월 100만원 / 800만원 = 12.5%
안전 마진 포함: 월 15% 목표
```

## 10. 성공 기준 및 다음 단계

### 10.1 성공 기준
```yaml
최소 성공 (Minimum Viable):
  - 1개 이상 모델이 월 10% 달성
  - 최대 낙폭 -5% 이내
  - 시스템 안정성 99%

완전 성공 (Full Success):
  - 2개 이상 모델이 월 15% 달성
  - 명확한 우승 모델 식별
  - 확장 가능성 검증
```

### 10.2 다음 단계
```
if 테스트 성공:
    1. 우승 모델 2개로 각 2000만원 확대 테스트 (2주)
    2. 최종 모델 선정
    3. 4000만원 본격 운영
    4. 다른 코인 페어 추가 (ETH, XRP)
    
else:
    1. 실패 원인 분석
    2. 모델 개선 또는 전략 수정
    3. Paper trading으로 재테스트
    4. 소액으로 재시작
```

## 11. 검증 체크리스트

### 11.1 테스트 시작 전 체크리스트
- [ ] 모든 모델 구현 완료
- [ ] 단위 테스트 통과
- [ ] Paper trading 검증
- [ ] API 키 설정 및 권한 확인
- [ ] 리스크 관리 시스템 작동
- [ ] 모니터링 대시보드 준비
- [ ] 비상 연락망 구축
- [ ] 백업 시스템 준비

### 11.2 일일 체크리스트
- [ ] 시스템 상태 확인
- [ ] 전일 거래 리뷰
- [ ] 이상 거래 분석
- [ ] 자본 잔액 확인
- [ ] API 상태 점검
- [ ] 로그 백업

## 12. 외부 평가 요청 사항

### 다른 LLM에게 평가받고 싶은 항목:

1. **테스트 설계의 공정성**
   - 각 모델에게 동일한 기회가 주어지는가?
   - 평가 지표가 편향되지 않았는가?

2. **리스크 관리의 충분성**
   - 식별되지 않은 리스크가 있는가?
   - 대응 방안이 현실적인가?

3. **통계적 유의성**
   - 4주 테스트가 충분한가?
   - 샘플 크기가 적절한가?

4. **실용성**
   - 계획이 실행 가능한가?
   - 비용 대비 기대 효과가 합리적인가?

5. **개선 제안**
   - 놓친 부분이 있는가?
   - 더 좋은 방법이 있는가?

---

*이 계획서는 실거래 테스트 전 최종 검토와 승인이 필요합니다.*
*작성자: Claude | 검토 요청: 다른 AI 모델*